<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yj.hqbz.mapper.goods.GoodsSKUMapper" >
  <resultMap id="BaseResultMap" type="com.yj.hqbz.model.goods.GoodsSKU" >
    <id column="SKUID" property="skuid" jdbcType="VARCHAR" />
    <result column="SKUCODE" property="skuCode" jdbcType="VARCHAR" />
    <result column="FK_GOODSID" property="goodsid" jdbcType="VARCHAR" />
    <result column="PROPERTY" property="property" jdbcType="VARCHAR" />
    <result column="SPEC" property="spec" jdbcType="VARCHAR" />
    <result column="SORTNO" property="sortNo" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    <result column="CREATEDATE" property="createDate" jdbcType="TIMESTAMP" />
    <result column="LASTEDITOR" property="lasteDitor" jdbcType="VARCHAR" />
    <result column="LASTEDITDATE" property="lasteDitDate" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    SKUID, SKUCODE, FK_GOODSID, PROPERTY, SPEC, SORTNO, STATUS, CREATOR, CREATEDATE, 
    LASTEDITOR, LASTEDITDATE
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from SKU
    where SKUID = #{skuid,jdbcType=VARCHAR}
  </select>
  <insert id="addGoodsSKU" parameterType="com.yj.hqbz.model.goods.GoodsSKU">
  	insert into SKU (
  	SKUID, SKUCODE, FK_GOODSID, PROPERTY, SPEC, SORTNO, STATUS, CREATOR, CREATEDATE
  	)
  	values (
  	#{skuid,jdbcType=VARCHAR},
  	(select nvl(TRIM(to_char(max(to_number(SKUCODE))+1,'00000009')),'00000001')
  	from SKU),
  	#{goodsid,jdbcType=VARCHAR},
  	#{property,jdbcType=VARCHAR},
  	#{spec,jdbcType=VARCHAR},
  	#{sortNo,jdbcType=VARCHAR},
  	#{status,jdbcType=DECIMAL},
  	#{creator,jdbcType=VARCHAR},
  	sysdate
  	)
  </insert>
  <update id="updateGoodsSKU" parameterType="com.yj.hqbz.model.goods.GoodsSKU">
  	update SKU t 
  	set 
  	t.PROPERTY=#{property,jdbcType=VARCHAR}ï¼Œ
  	t.SPEC=#{spec,jdbcType=VARCHAR},
  	t.SORTNO=#{sortNo,jdbcType=VARCHAR},
  	t.STATUS=#{status,jdbcType=DECIMAL},
  	t.LASTEDITOR=#{lasteDitor,jdbcType=VARCHAR},
  	t.LASTEDITDATE=sysdate
  	where t.SKUID=#{skuid}
  </update>
  <select id="getGoodsSKUByGoodsId" parameterType="java.lang.String" resultMap="BaseResultMap" >
  	select 
    <include refid="Base_Column_List" />
    from SKU
    where FK_GOODSID=#{goodsId} and STATUS &lt;&gt; 2
  </select>
  <update id="updateGoodsSKUStaus" parameterType="com.yj.hqbz.model.goods.GoodsSKU">
  	update SKU t 
  	set 
  	t.STATUS=#{status,jdbcType=DECIMAL},
  	t.LASTEDITOR = #{lasteDitor,jdbcType=VARCHAR},
  	t.LASTEDITDATE = #{lasteDitDate,jdbcType=TIMESTAMP}
  	where t.SKUID=#{skuid,jdbcType=VARCHAR}
  </update>
  <delete id="deleteGoodsSku" parameterType="com.yj.hqbz.model.goods.GoodsSKU" >
  	update SKU t 
  	set 
  	t.STATUS = #{status,jdbcType=DECIMAL},
  	t.LASTEDITOR = #{lasteDitor,jdbcType=VARCHAR},
  	t.LASTEDITDATE = #{lasteDitDate,jdbcType=TIMESTAMP}
  	where t.SKUID=#{skuid,jdbcType=VARCHAR}
  </delete>
  <select id="getGoodsSpecByGoodsId" parameterType="java.lang.String" resultType="java.lang.String">
  	select
		(select count(1) from sku g where
		 g.fk_goodsid=#{goodsid,jdbcType=VARCHAR}  and g.status = 0 )
		 ||'/'||
		(select count(1) from sku t where
		 t.fk_goodsid=#{goodsid,jdbcType=VARCHAR}  and t.status != 2)
		  as spec 
	from dual
  </select>
</mapper>