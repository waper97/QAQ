package com.yj.hqbz.controller.goods;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;

import org.apache.commons.collections.MapUtils;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.yj.common.controller.BaseController;
import com.yj.hqbz.model.goods.GoodsType;
import com.yj.hqbz.services.goods.GoodsPicInfoService;
import com.yj.hqbz.services.goods.GoodsSKUService;
import com.yj.hqbz.services.goods.GoodsService;
import com.yj.hqbz.services.goods.GoodsTypeService;
import com.yj.hqbz.services.goods.GoodsUnitService;
import com.yj.hqbz.util.FileUtil;
import com.yj.hqbz.util.XlsReadUtil;

@RestController
public class GoodsImportController extends BaseController{

	@Resource
	GoodsService goodsService;	
	@Resource
	GoodsPicInfoService goodsPicInfoService;	
	@Resource
	GoodsTypeService goodsTypeService;
	/**
	 * 导入商品信息[未完]
	 * @return
	 */
	@PostMapping("importGoodsXls")
	public Object importGoods(@RequestParam(value="hqfile") MultipartFile hqfile){
		XlsReadUtil xlsReader = new XlsReadUtil();
		String fileName = hqfile.getOriginalFilename();
		String msg = FileUtil.checkFileIsValid(fileName, ".XLS,.XLSX"); 
		if(msg!=null && !"".equals(msg)){
			return fail(msg);
		}
		else {
			try {
				List list = xlsReader.readExcel(fileName, hqfile.getInputStream());				
				if(list != null && list.size()>0){
					int size = list.size();
					for( int i = 0 ;i<size; ++i){
						Map item = (HashMap)list.get(i);
						String goodsNo 	= MapUtils.getString(item,"columns_0");  //商品序号
						String specNo	= MapUtils.getString(item, "columns_1"); //规格序号
						String businessAtt = MapUtils.getString(item, "columns_2"); //业务属性
						String goodsTypeNF = MapUtils.getString(item, "columns_3"); //一级分类名称
						String goodsTypeAF = MapUtils.getString(item, "columns_4");  //一级分类别名
						String goodsTypeNS = MapUtils.getString(item, "columns_5");  //二级分类名称
						String goodsTypeAS = MapUtils.getString(item, "columns_6");  //二级分类别名
						String goodsName 	= MapUtils.getString(item, "columns_7"); //商品名称
						String goodsAlias 	= MapUtils.getString(item, "columns_8"); //商品别名
						String goodsUnit	= MapUtils.getString(item, "columns_9"); //商品基本单位
						String goodsUnitDef = MapUtils.getString(item, "columns_10"); //自定义商品基本单位
						String goodsDesc	= MapUtils.getString(item, "columns_11"); //商品描述
						String remark		= MapUtils.getString(item, "columns_12"); //商品说明 (需要读取word文件)
						String specName		= MapUtils.getString(item, "columns_13"); //规格名称
						String specRemark	= MapUtils.getString(item, "columns_14"); //规格描述
						
						//先处理商品分类
						
					}
				}
				return null;
			}
			catch(Exception ex){
				return fail(ex.getMessage());
			}
		}
	}
	
	/**
	 * 处理商品分类信息
	 * @param firstGoodsTypeName
	 * @param firstGoodsAliasName
	 * @param secondGoodsTypeName
	 * @param secondGoodsTypeAliasName
	 * @param businessAtt 商品业务属性
	 * @return
	 */
	private GoodsType getGoodsTypeInfo(String firstGoodsTypeName,String firstGoodsAliasName,
			String secondGoodsTypeName,String secondGoodsTypeAliasName,String businessAtt){
		return null;
	}
	
}
