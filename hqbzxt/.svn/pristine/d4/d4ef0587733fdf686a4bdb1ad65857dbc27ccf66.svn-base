
	<form id="frm" class="easyui-form" method="post" style="margin: 10;text-align: left;">
		<input type="hidden" id="roleid" name="roleid"/>
		<table cellpadding="5">
			<tr>
				<td valign='top'>分配资源</td>
				<td><ul id="tt" class="easyui-tree" data-options="method:'get',animate:false,checkbox:true" >

			</ul></td>
			</tr>			
		</table>
	</form>
<script>
var roleid ;

function getRoleHaveRes(id,rtype){
	$("#tt").tree({  
        url:baseUrl+'/res/manage/getResTree?resType='+rtype,
        onLoadSuccess:function(node,data){
        	$('#frm #roleid').val(id);
        	roleid = id;
        	YJGet("/role/manage/getRoleRes",{roleid:id},function(data){
        		if(data.success){
        			var arr = data.data;
        			initTreeCheck(arr);
        		}
        		else{
        			error(data.message);
        		}
        	})
        },
        onBeforeLoad: function (node, param) {
   		 $("<div class=\"datagrid-mask\"></div>").css({ display: "block", width: "100%", height: "100%" }).appendTo("#tt");
            $("<div class=\"datagrid-mask-msg\"></div>").html("正在加载数据，请稍待...").appendTo("#tt").css({ display: "block" });
        }
	});
	
}

	
	function initTreeCheck(arr){
		for(var i = 0 ;i<arr.length;++i){
			console.log(arr[i]);
			var node = $('#tt').tree('find',arr[i]); 
			if(node!=null){
				if($('#tt').tree('isLeaf',node.target)){
					$('#tt').tree('check', node.target);
				}
			}
		}
	}

	
	function submitForm(){
		//获取选中的树节点数据，保存到数据库中
		var nodes = $('#tt').tree('getChecked'); //获取 checkbox选中的几点，不含实心圆点
		var s = '';
		for(var i=0; i<nodes.length; i++){
			if (nodes[i].id!='0') {
				if(s != '')
					s += ',';
				s += nodes[i].id;
			}			
		}
		
		nodes = $('#tt').tree('getChecked','indeterminate');
		for(var i=0; i<nodes.length; i++){
			if (nodes[i].id!='0') {
				if(s!='') s += ',';
				s += nodes[i].id;
			}
		}
		
		var datas = {roleid:roleid,res:s};
		
		YJPost("/role/manage/saveRoleRes",datas,function(data){
			if(data.success){
				$('#MyPopWindow').window('close');
				msg(data.message);
			}
			else{
				error(data.message);
			}
		})		
	}
</script>