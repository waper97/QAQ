<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yj.hqbz.mapper.user.UserInfoMapper" >
  <resultMap id="BaseResultMap" type="com.yj.hqbz.model.user.UserInfo" >
    <id column="USERID" property="userid" jdbcType="VARCHAR" />
    <result column="ADDTIME" property="addTime" jdbcType="TIMESTAMP" />
    <result column="DELETESTATUS" property="deleteStatus" jdbcType="DECIMAL" /> 
    <result column="ADDRESS" property="address" jdbcType="DECIMAL" />
    <result column="BIRTHDAY" property="birthday" jdbcType="TIMESTAMP" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="SEX" property="sex" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="TRUENAME" property="trueName" jdbcType="VARCHAR" />
    <result column="USERNAME" property="userName" jdbcType="VARCHAR" />
    <result column="USERROLE" property="userRole" jdbcType="DECIMAL" />
    <result column="PHOTO_ID" property="photoId" jdbcType="DECIMAL" />
    <result column="ORG_ID" property="orgId" jdbcType="DECIMAL" />
    <result column="ADD_PERSON" property="addPerson" jdbcType="VARCHAR" />
    <result column="WX_OPENID" property="wxOpenid" jdbcType="VARCHAR" />
    <result column="ORGNAME" property="orgName" jdbcType="VARCHAR" />
    <result column="BEGINTIME" property="beginTime" jdbcType="VARCHAR" />
    <result column="ENDTIME" property="endTime" jdbcType="VARCHAR" />
    <result column="HEADTHUMBNAILURL" property="headThumbnailUrl" jdbcType="VARCHAR" />
    <result column="ORG_MANAGER" property="orgManager" jdbcType="DECIMAL" />
  </resultMap>
  <sql id="Base_Column_List" >
    USERID, ADDTIME, DELETESTATUS, ADDRESS, BIRTHDAY, MOBILE, PASSWORD, SEX, STATUS, TRUENAME, USERNAME, 
    USERROLE, PHOTO_ID, ORG_ID, ADD_PERSON, WX_OPENID, HEADTHUMBNAILURL,ORG_MANAGER
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    u.USERID, u.ADDTIME, u.DELETESTATUS, u.ADDRESS, u.BIRTHDAY, u.MOBILE, u.PASSWORD, u.SEX, u.STATUS, u.TRUENAME, u.USERNAME, 
    u.USERROLE, u.PHOTO_ID, u.ORG_ID, u.ADD_PERSON, u.WX_OPENID, u.HEADTHUMBNAILURL, o.name as orgName
    from HQXT_USER u left join ORGANIZATION o on u.ORG_ID=o.ORGID 
    where USERID = #{userid,jdbcType=VARCHAR} and u.STATUS=0 
    and u.DELETESTATUS=0
  </select>
  
  <select id="getUserList" resultMap="BaseResultMap" parameterType="com.yj.hqbz.model.user.UserInfo">
  	select u.USERID, u.USERNAME,u.TRUENAME,u.MOBILE,u.SEX,o.NAME,u.ADDTIME,u.ORG_MANAGER,
  	       u.BIRTHDAY,op.TRUENAME as ADD_PERSON,o.name as orgName
  		   from HQXT_USER u 
  		   left join ORGANIZATION o on u.ORG_ID=o.ORGID 
  		   left join HQXT_USER op on u.ADD_PERSON=op.userid
  	where 1=1 and u.DELETESTATUS = 0 
  	<if test="userName!=null and userName!=''">
  		 and instr(u.USERNAME,#{userName,jdbcType=VARCHAR})>0
  	</if>
  	<if test="trueName!=null and trueName!=''">
  		 and instr(u.TRUENAME,#{trueName,jdbcType=VARCHAR})>0
  	</if>
  	<if test="orgId!=null and orgId!=''">
  		 and u.ORG_ID=#{orgId}
  	</if>
  	<if test="orgName!=null and orgId!=''">
  		 and instr(o.name,#{orgName,jdbcType=VARCHAR})>0
  	</if>
  	<if test="beginTime!=null and beginTime!=''">
  		<![CDATA[ and u.ADDTIME >= to_date(#{beginTime,jdbcType=DATE},'yyyy-MM-dd hh24:mi:ss')]]>
  	</if>
  	<if test="endTime!=null and endTime!=''">
  		<![CDATA[ and u.ADDTIME <= to_date(#{endTime,jdbcType=DATE},'yyyy-MM-dd hh24:mi:ss')]]>
  	</if>
  	order by u.ADDTIME DESC
  </select>
  
  <select id="getOrgUserList" resultMap="BaseResultMap" parameterType="java.util.Map">
  	select u.USERID, u.USERNAME,u.TRUENAME,u.MOBILE,u.SEX,o.NAME,o.name as orgName  	
  	from HQXT_USER u,ORGANIZATION o 
  	where u.ORG_ID=o.ORGID  and u.DELETESTATUS = 0 
  	<if test="keywords!=null and keywords!=''">
  		 and (instr(u.USERNAME,#{keywords,jdbcType=VARCHAR})>0 or instr(u.TRUENAME,#{keywords,jdbcType=VARCHAR})>0)
  	</if>
  	<if test="trueName!=null and trueName!=''">
  		 and instr(u.TRUENAME,#{trueName,jdbcType=VARCHAR})>0
  	</if>
  	<if test="orgIdArr!=null">
		and	u.ORG_ID in
		<foreach collection="orgIdArr" open="(" separator="," close=")" item="item">
			#{item,jdbcType=DECIMAL}
		</foreach>
	</if>  	
  	order by u.ADDTIME DESC
  </select>
  
  
  <select id="selectUserByUserName" parameterType="java.lang.String" resultMap="BaseResultMap">
  	select
  	<include refid="Base_Column_List" />
  	from HQXT_USER
  	where USERNAME = #{username,jdbcType=VARCHAR} and STATUS=0 and DELETESTATUS=0
  </select>
  
  <select id="getUserByPhone" parameterType="java.lang.String" resultMap="BaseResultMap">
  	select
  	<include refid="Base_Column_List" />
  	from HQXT_USER
  	where MOBILE = #{phone,jdbcType=VARCHAR} and STATUS=0 and DELETESTATUS=0
  </select>
  
  <update id="updateUserInfo" parameterType="com.yj.hqbz.model.user.UserInfo">
  	update HQXT_USER
  	<set>
       <if test="birthday != null" >
         birthday = #{birthday,jdbcType=TIMESTAMP},
       </if>
       <if test="mobile != null" >
         mobile = #{mobile,jdbcType=VARCHAR},
       </if>
       <if test="sex != null" >
         sex = #{sex,jdbcType=DECIMAL},
       </if>
       <if test="trueName != null" >
         trueName = #{trueName,jdbcType=VARCHAR},
       </if>
       <if test="orgId != null" >
         orgId = #{orgId,jdbcType=DECIMAL},
       </if> 
       <if test="userRole != null" >
         USERROLE = #{userRole,jdbcType=DECIMAL},
       </if>  
       <if test="orgManager != null" > 
       		ORG_MANAGER = #{orgManager,jdbcType=DECIMAL},
       </if>
  	</set>
  	 where userid = #{userid,jdbcType=VARCHAR}
  </update>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete 
    from HQXT_USER
    where USERID = #{userid,jdbcType=VARCHAR}
  </delete>
  
  <insert id="insert" parameterType="com.yj.hqbz.model.user.UserInfo" >
    insert into HQXT_USER (USERID, ADDTIME, DELETESTATUS,ADDRESS, 
      BIRTHDAY, MOBILE, 
      PASSWORD, SEX, STATUS, TRUENAME, USERNAME, 
      USERROLE, PHOTO_ID, ORG_ID, ADD_PERSON,ORG_MANAGER)
    values (#{userid,jdbcType=VARCHAR}, #{addTime,jdbcType=TIMESTAMP}, #{deleteStatus,jdbcType=DECIMAL}, 
      #{address,jdbcType=VARCHAR}, #{birthday,jdbcType=TIMESTAMP}, #{mobile,jdbcType=VARCHAR}, 
      #{password,jdbcType=VARCHAR}, #{sex,jdbcType=DECIMAL}, #{status,jdbcType=DECIMAL}, 
      #{trueName,jdbcType=VARCHAR}, #{userName,jdbcType=VARCHAR}, #{userRole,jdbcType=DECIMAL}, 
      #{photoId,jdbcType=DECIMAL}, #{orgId,jdbcType=DECIMAL}, #{addPerson,jdbcType=VARCHAR},
      #{orgManager,jdbcType=DECIMAL})
  </insert>
  
  <update id="resetPwdById" parameterType="map">
  	update HQXT_USER 
  	SET PASSWORD=#{password,jdbcType=VARCHAR} 
  	where USERID = #{userid,jdbcType=VARCHAR}
  </update>
 
</mapper>